package analysis

import (
	"fmt"
	"log"
	"os"
	"strings"
	"testing"

	"github.com/frk/compare"
	"github.com/frk/isvalid/internal/search"
	"github.com/frk/tagutil"
)

var testast search.AST
var testpkg search.Package

func TestMain(m *testing.M) {
	pkgs, err := search.Search("../testdata/analysis", false, nil, &testast)
	if err != nil {
		log.Fatal(err)
	}
	testpkg = *(pkgs[0])

	os.Exit(m.Run())
}

func TestAddRuleFunc(t *testing.T) {
	tests := []struct {
		rulename string
		pkgpath  string
		funcname string
		err      error
		want     Config
		printerr bool
	}{{
		rulename: "isvalid",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyRule",
		err: &anError{Code: errRuleNameReserved, RuleName: "isvalid"},
	}, {
		rulename: "-isvalid",
		pkgpath:  "strings", funcname: "Contains",
		err: &anError{Code: errRuleNameReserved, RuleName: "-isvalid"},
	}, {
		rulename: "enum",
		pkgpath:  "strings", funcname: "Contains",
		err: &anError{Code: errRuleNameReserved, RuleName: "enum"},
	}, {
		rulename: "myrule",
		pkgpath:  "strings", funcname: "TrimLeftFunc",
		err: &anError{
			Code:    errRuleFuncSignature,
			FuncPkg: "strings", FuncName: "TrimLeftFunc",
			FuncType: "func(s string, f func(rune) bool) string",
		},
	}, {
		rulename: "myrule",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyBadRule1",
		err: &anError{
			Code:    errRuleFuncSignature,
			FuncPkg: "github.com/frk/isvalid/internal/testdata/mypkg", FuncName: "MyBadRule1",
			FuncType: "func() bool",
		},
	}, {
		rulename: "myrule",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyBadRule2",
		err: &anError{
			Code:    errRuleFuncSignature,
			FuncPkg: "github.com/frk/isvalid/internal/testdata/mypkg", FuncName: "MyBadRule2",
			FuncType: "func(v string) int",
		},
	}, {
		rulename: "myrule",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyBadRule3",
		err: &anError{
			Code:    errRuleFuncSignature,
			FuncPkg: "github.com/frk/isvalid/internal/testdata/mypkg", FuncName: "MyBadRule3",
			FuncType: "func(v int64, i int, f float64, s string, b bool) (bool, error)",
		},
	}, {
		rulename: "myrule",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyRule",
		want: Config{ruleSpecMap: map[string]RuleSpec{
			"myrule": RuleFunc{
				iscustom: true,
				FuncName: "MyRule",
				PkgPath:  "github.com/frk/isvalid/internal/testdata/mypkg",
				ArgTypes: []Type{{Kind: TypeKindString}},
			},
		}},
	}, {
		rulename: "myrule",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyRule2",
		want: Config{ruleSpecMap: map[string]RuleSpec{
			"myrule": RuleFunc{
				iscustom:   true,
				FuncName:   "MyRule2",
				PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
				ArgTypes:   []Type{{Kind: TypeKindSlice, Elem: &Type{Kind: TypeKindString}}},
				IsVariadic: true,
			},
		}},
	}, {
		rulename: "myrule",
		pkgpath:  "github.com/frk/isvalid/internal/testdata/mypkg", funcname: "MyRule3",
		want: Config{ruleSpecMap: map[string]RuleSpec{
			"myrule": RuleFunc{
				iscustom: true,
				FuncName: "MyRule3",
				PkgPath:  "github.com/frk/isvalid/internal/testdata/mypkg",
				ArgTypes: []Type{
					{Kind: TypeKindInt64},
					{Kind: TypeKindInt},
					{Kind: TypeKindFloat64},
					{Kind: TypeKindString},
					{Kind: TypeKindBool},
				},
			},
		}},
	}}

	compare := compare.Config{ObserveFieldTag: "cmp"}

	for _, tt := range tests {
		t.Run(tt.rulename, func(t *testing.T) {
			fn, err := search.FindFunc(tt.pkgpath, tt.funcname, testast)
			if err != nil {
				t.Fatal(err)
			}

			var conf Config
			err = conf.AddRuleFunc(tt.rulename, fn)
			if e := compare.Compare(err, tt.err); e != nil {
				t.Errorf("Error: %v", e)
			}
			if e := compare.Compare(conf, tt.want); e != nil {
				t.Error(e)
			}

			if tt.printerr && err != nil {
				fmt.Println(err)
			}
		})
	}
}

func TestAnalysisRun(t *testing.T) {
	originalhook := filenamehook
	defer func() { filenamehook = originalhook }()

	filenamehook = func(name string) string {
		if i := strings.LastIndex(name, "github.com/frk/"); i > -1 {
			return name[i:]
		}
		return name
	}

	file_analysis_bad := "github.com/frk/isvalid/internal/testdata/analysis/analyze_bad.go"

	tests := []struct {
		name     string
		want     *ValidatorStruct
		err      error
		printerr bool
	}{{
		name: "AnalysisTestBAD_ErrorHandlerFieldConflictValidator",
		err: &anError{Code: errErrorHandlerFieldConflict,
			VtorName:      "AnalysisTestBAD_ErrorHandlerFieldConflictValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "MyErrorAggregator",
			FieldType:     "mypkg.MyErrorAggregator",
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
		},
	}, {
		name: "AnalysisTestBAD_ContextOptionFieldConflictValidator",
		err: &anError{Code: errContextOptionFieldConflict,
			VtorName:      "AnalysisTestBAD_ContextOptionFieldConflictValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "context",
			FieldType:     "string",
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
		},
	}, {
		name: "AnalysisTestBAD_ContextOptionFieldTypeValidator",
		err: &anError{Code: errContextOptionFieldType,
			VtorName:      "AnalysisTestBAD_ContextOptionFieldTypeValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "Context",
			FieldType:     "int",
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
		},
	}, {
		name: "AnalysisTestBAD_EmptyValidator",
		err: &anError{Code: errValidatorNoField,
			VtorName:     "AnalysisTestBAD_EmptyValidator",
			VtorFileName: file_analysis_bad,
			VtorFileLine: 123,
		},
	}, {
		name: "AnalysisTestBAD_Empty2Validator",
		err: &anError{Code: errValidatorNoField,
			VtorName:     "AnalysisTestBAD_Empty2Validator",
			VtorFileName: file_analysis_bad,
			VtorFileLine: 123,
		},
	}, {
		name: "AnalysisTestBAD_Empty3Validator",
		err: &anError{Code: errValidatorNoField,
			VtorName:     "AnalysisTestBAD_Empty3Validator",
			VtorFileName: file_analysis_bad,
			VtorFileLine: 123,
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumRequiredValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumRequiredValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"required:foobar"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "required",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumNotNilValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumNotNilValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]string",
			FieldTag:      tagutil.Tag{"is": {"notnil:foobar"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "notnil",
		},
	}, {
		name: "AnalysisTestBAD_TypeNilNotNilValidator",
		err: &anError{Code: errTypeNil,
			VtorName:      "AnalysisTestBAD_TypeNilNotNilValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[4]string",
			FieldTag:      tagutil.Tag{"is": {"notnil"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "notnil",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumEmailValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumEmailValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"email:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "email",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringEmailValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringEmailValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"email"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "email",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumURLValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumURLValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"url:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "url",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringURLValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringURLValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"url"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "url",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumURIValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumURIValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"uri:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uri",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringURIValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringURIValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"uri"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uri",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumPANValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumPANValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"pan:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "pan",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringPANValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringPANValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "bool",
			FieldTag:      tagutil.Tag{"is": {"pan"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "pan",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumCVVValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumCVVValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"cvv:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "cvv",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringCVVValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringCVVValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "bool",
			FieldTag:      tagutil.Tag{"is": {"cvv"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "cvv",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumSSNValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumSSNValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ssn:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ssn",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringSSNValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringSSNValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "bool",
			FieldTag:      tagutil.Tag{"is": {"ssn"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ssn",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumEINValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumEINValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ein:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ein",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringEINValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringEINValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "bool",
			FieldTag:      tagutil.Tag{"is": {"ein"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ein",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumNumericValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumNumericValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"numeric:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "numeric",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringNumericValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringNumericValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"numeric"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "numeric",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumHexValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumHexValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"hex:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "hex",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringHexValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringHexValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"hex"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "hex",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumHexcolorValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumHexcolorValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"hexcolor:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "hexcolor",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringHexcolorValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringHexcolorValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"hexcolor"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "hexcolor",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumAlphanumValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumAlphanumValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"alphanum:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "alphanum",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringAlphanumValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringAlphanumValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"alphanum"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "alphanum",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumCIDRValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumCIDRValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"cidr:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "cidr",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringCIDRValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringCIDRValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"cidr"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "cidr",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringPhoneValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringPhoneValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"phone"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "phone",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypePhoneValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypePhoneValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"phone:321"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "phone",
			RuleArg:       &RuleArg{Value: "321", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueCountryCodePhoneValidator",
		err: &anError{Code: errRuleArgValueCountryCode,
			VtorName:      "AnalysisTestBAD_RuleArgValueCountryCodePhoneValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"phone:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "phone",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindPhoneValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindPhoneValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"phone:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "phone",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringZipValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringZipValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"zip"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "zip",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeZipValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeZipValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"zip:321"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "zip",
			RuleArg:       &RuleArg{Value: "321", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueCountryCodeZipValidator",
		err: &anError{Code: errRuleArgValueCountryCode,
			VtorName:      "AnalysisTestBAD_RuleArgValueCountryCodeZipValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"zip:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "zip",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindZipValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindZipValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"zip:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "zip",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringUUIDValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringUUIDValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint16",
			FieldTag:      tagutil.Tag{"is": {"uuid"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uuid",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeUUIDValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeUUIDValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"uuid:-4"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uuid",
			RuleArg:       &RuleArg{Value: "-4", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueUUIDVerUUIDValidator",
		err: &anError{Code: errRuleArgValueUUIDVer,
			VtorName:      "AnalysisTestBAD_RuleArgValueUUIDVerUUIDValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"uuid:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uuid",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindUUIDValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindUUIDValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"uuid:&x:&y:&z"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uuid",
			RuleArg:       &RuleArg{Value: "z", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueConflictUUIDValidator",
		err: &anError{Code: errRuleArgValueConflict,
			VtorName:      "AnalysisTestBAD_RuleArgValueConflictUUIDValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"uuid:v4:5:4"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uuid",
			RuleArg:       &RuleArg{Value: "4", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumUUIDValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumUUIDValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"uuid:1:2:3:4:5:6"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "uuid",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringIPValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringIPValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint8",
			FieldTag:      tagutil.Tag{"is": {"ip"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ip",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeIPValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeIPValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ip:-4"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ip",
			RuleArg:       &RuleArg{Value: "-4", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueIPVerIPValidator",
		err: &anError{Code: errRuleArgValueIPVer,
			VtorName:      "AnalysisTestBAD_RuleArgValueIPVerIPValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ip:v7"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ip",
			RuleArg:       &RuleArg{Value: "v7", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindIPValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindIPValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ip:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ip",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueConflictIPValidator",
		err: &anError{Code: errRuleArgValueConflict,
			VtorName:      "AnalysisTestBAD_RuleArgValueConflictIPValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ip:v4:4"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ip",
			RuleArg:       &RuleArg{Value: "4", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumIPValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumIPValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"ip:v4:v6:v8"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ip",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringMACValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringMACValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint32",
			FieldTag:      tagutil.Tag{"is": {"mac"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "mac",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeMACValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeMACValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"mac:-6"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "mac",
			RuleArg:       &RuleArg{Value: "-6", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueMACVerMACValidator",
		err: &anError{Code: errRuleArgValueMACVer,
			VtorName:      "AnalysisTestBAD_RuleArgValueMACVerMACValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"mac:v10"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "mac",
			RuleArg:       &RuleArg{Value: "v10", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindMACValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindMACValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"mac:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "mac",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueConflictMACValidator",
		err: &anError{Code: errRuleArgValueConflict,
			VtorName:      "AnalysisTestBAD_RuleArgValueConflictMACValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"mac:v6:6"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "mac",
			RuleArg:       &RuleArg{Value: "6", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumMACValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumMACValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"mac:6:8:10"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "mac",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringISOValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringISOValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "complex128",
			FieldTag:      tagutil.Tag{"is": {"iso:1234"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "iso",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueISOStdISOValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgValueISOStdISOValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"iso:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "iso",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindISOValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindISOValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"iso:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "iso",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumISOValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumISOValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"iso"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "iso",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2ISOValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2ISOValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"iso:6:8"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "iso",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringRFCValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringRFCValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"rfc:1234"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rfc",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueRFCStdRFCValidator",
		err: &anError{Code: errRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgValueRFCStdRFCValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rfc:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rfc",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindRFCValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindRFCValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rfc:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rfc",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumRFCValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumRFCValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rfc"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rfc",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2RFCValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2RFCValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rfc:6:8"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rfc",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringRegexpValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringRegexpValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"re:abc"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "re",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueRegexpRegexpValidator",
		err: &anError{Code: errRuleArgValueRegexp,
			VtorName:      "AnalysisTestBAD_RuleArgValueRegexpRegexpValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"re:^($"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "re",
			RuleArg:       &RuleArg{Value: "^($", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindRegexpValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindRegexpValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"re:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "re",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumRegexpValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumRegexpValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"re"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "re",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2RegexpValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2RegexpValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {`re:foo:bar`}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "re",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringPrefixValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringPrefixValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"prefix:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "prefix",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindPrefixValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindPrefixValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"prefix:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "prefix",
			RuleArg:       &RuleArg{Value: "y", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumPrefixValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumPrefixValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"prefix"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "prefix",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringSuffixValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringSuffixValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"suffix:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "suffix",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindSuffixValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindSuffixValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"suffix:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "suffix",
			RuleArg:       &RuleArg{Value: "y", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumSuffixValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumSuffixValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"suffix"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "suffix",
		},
	}, {
		name: "AnalysisTestBAD_TypeKindStringContainsValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_TypeKindStringContainsValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"contains:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "contains",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindContainsValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindContainsValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"contains:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "contains",
			RuleArg:       &RuleArg{Value: "y", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumContainsValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumContainsValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"contains"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "contains",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumEQValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumEQValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"eq"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "eq",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeStringEQValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeStringEQValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"eq:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "eq",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintEQValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintEQValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"eq:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "eq",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeUintEQValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeUintEQValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]byte",
			FieldTag:      tagutil.Tag{"is": {"eq:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "eq",
			RuleArg:       &RuleArg{Value: "123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatEQValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatEQValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"eq:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "eq",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindEQValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindEQValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"eq:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "eq",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumNEValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumNEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"ne"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ne",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeStringNEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeStringNEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"ne:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ne",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintNEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintNEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"ne:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ne",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeUintNEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeUintNEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]byte",
			FieldTag:      tagutil.Tag{"is": {"ne:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ne",
			RuleArg:       &RuleArg{Value: "123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatNEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatNEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"ne:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ne",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindNEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindNEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"ne:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "ne",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumGTValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumGTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"gt"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gt",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2GTValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2GTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"gt:1:2"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gt",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericGTValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericGTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"gt:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gt",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintGTValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintGTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"gt:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gt",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatGTValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatGTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"gt:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gt",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindGTValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindGTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"gt:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gt",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumLTValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumLTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"lt"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lt",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2LTValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2LTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"lt:1:2"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lt",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericLTValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericLTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"lt:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lt",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintLTValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintLTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"lt:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lt",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatLTValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatLTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"lt:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lt",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindLTValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindLTValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"lt:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lt",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumGTEValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumGTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"gte"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gte",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2GTEValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2GTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"gte:1:2"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gte",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericGTEValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericGTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"gte:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gte",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintGTEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintGTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"gte:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gte",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatGTEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatGTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"gte:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gte",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindGTEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindGTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"gte:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "gte",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumLTEValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumLTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"lte"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lte",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2LTEValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2LTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"lte:1:2"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lte",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericLTEValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericLTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"lte:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lte",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintLTEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintLTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"lte:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lte",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatLTEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatLTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"lte:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lte",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindLTEValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindLTEValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"lte:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "lte",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumMinValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumMinValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"min"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "min",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2MinValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2MinValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"min:1:2"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "min",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericMinValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericMinValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"min:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "min",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintMinValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintMinValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"min:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "min",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatMinValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatMinValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"min:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "min",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindMinValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindMinValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"min:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "min",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumMaxValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumMaxValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"max"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "max",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2MaxValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2MaxValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"max:1:2"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "max",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericMaxValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericMaxValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"max:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "max",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintMaxValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintMaxValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"max:-123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "max",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatMaxValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatMaxValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"max:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "max",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindMaxValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindMaxValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"max:&x"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "max",
			RuleArg:       &RuleArg{Value: "x", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumRngValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"rng"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2RngValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2RngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"rng:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum3RngValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum3RngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"rng:1:2:3"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
		},
	}, {
		name: "AnalysisTestBAD_TypeNumericRngValidator",
		err: &anError{Code: errTypeNumeric,
			VtorName:      "AnalysisTestBAD_TypeNumericRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rng:1:23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeStringRngValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeStringRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint64",
			FieldTag:      tagutil.Tag{"is": {"rng:foo:bar"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeNintRngValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeNintRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "uint",
			FieldTag:      tagutil.Tag{"is": {"rng:-123:0"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeFloatRngValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeFloatRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"rng::1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueBoundsRngValidator",
		err: &anError{Code: errRuleArgValueBounds,
			VtorName:      "AnalysisTestBAD_RuleArgValueBoundsRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "float32",
			FieldTag:      tagutil.Tag{"is": {"rng:2:1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindRngValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindRngValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"rng:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rng",
			RuleArg:       &RuleArg{Value: "y", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNumLenValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNumLenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]string",
			FieldTag:      tagutil.Tag{"is": {"len"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgNum2LenValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleArgNum2LenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]string",
			FieldTag:      tagutil.Tag{"is": {"len:1:2:3"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
		},
	}, {
		name: "AnalysisTestBAD_TypeLengthLenValidator",
		err: &anError{Code: errTypeLength,
			VtorName:      "AnalysisTestBAD_TypeLengthLenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int32",
			FieldTag:      tagutil.Tag{"is": {"len:1:23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeLenValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeLenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]string",
			FieldTag:      tagutil.Tag{"is": {"len:foo:bar"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
			RuleArg:       &RuleArg{Value: "foo", Type: ArgTypeString},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgType2LenValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgType2LenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "map[string]struct{}",
			FieldTag:      tagutil.Tag{"is": {"len:-123:0"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
			RuleArg:       &RuleArg{Value: "-123", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgType3LenValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgType3LenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]string",
			FieldTag:      tagutil.Tag{"is": {"len::1.23"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
			RuleArg:       &RuleArg{Value: "1.23", Type: ArgTypeFloat},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgValueBoundsLenValidator",
		err: &anError{Code: errRuleArgValueBounds,
			VtorName:      "AnalysisTestBAD_RuleArgValueBoundsLenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]string",
			FieldTag:      tagutil.Tag{"is": {"len:20:10"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
			RuleArg:       &RuleArg{Value: "10", Type: ArgTypeInt},
		},
	}, {
		name: "AnalysisTestBAD_RuleArgTypeReferenceKindLenValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleArgTypeReferenceKindLenValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "[]int8",
			FieldTag:      tagutil.Tag{"is": {"len:&x:&y"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "len",
			RuleArg:       &RuleArg{Value: "y", Type: ArgTypeField},
		},
	}, {
		name: "AnalysisTestBAD_RuleFuncRuleArgCountValidator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleFuncRuleArgCountValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rulefunc1"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rulefunc1",
		},
	}, {
		name: "AnalysisTestBAD_RuleFuncRuleArgCount2Validator",
		err: &anError{Code: errRuleFuncRuleArgCount,
			VtorName:      "AnalysisTestBAD_RuleFuncRuleArgCount2Validator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rulefunc1:a:b:c"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rulefunc1",
		},
	}, {
		name: "AnalysisTestBAD_RuleFuncFieldArgTypeValidator",
		err: &anError{Code: errRuleFuncFieldArgType,
			VtorName:      "AnalysisTestBAD_RuleFuncFieldArgTypeValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "int",
			FieldTag:      tagutil.Tag{"is": {"rulefunc1:123"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rulefunc1",
		},
	}, {
		name: "AnalysisTestBAD_RuleFuncRuleArgTypeValidator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleFuncRuleArgTypeValidator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rulefunc1:foo"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rulefunc1",
			RuleArg:       &RuleArg{Type: ArgTypeString, Value: "foo"},
		},
	}, {
		name: "AnalysisTestBAD_RuleFuncRuleArgType2Validator",
		err: &anError{Code: errRuleFuncRuleArgType,
			VtorName:      "AnalysisTestBAD_RuleFuncRuleArgType2Validator",
			VtorFileName:  file_analysis_bad,
			VtorFileLine:  123,
			FieldName:     "F",
			FieldType:     "string",
			FieldTag:      tagutil.Tag{"is": {"rulefunc2:123:true:false:abc"}},
			FieldFileName: file_analysis_bad,
			FieldFileLine: 123,
			RuleName:      "rulefunc2",
			RuleArg:       &RuleArg{Type: ArgTypeString, Value: "abc"},
		},
	}, {
		name: "AnalysisTestOK_ErrorConstructorValidator",
		want: &ValidatorStruct{
			TypeName: "AnalysisTestOK_ErrorConstructorValidator",
			ErrorHandler: &ErrorHandlerField{
				Name: "MyErrorConstructor", IsAggregator: false,
			},
			Fields: []*StructField{{
				Name: "F", Key: "F",
				Tag:  tagutil.Tag{"is": []string{"required"}},
				Type: Type{Kind: TypeKindString}, IsExported: true,
				RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}}},
			}},
		},
	}, {
		name: "AnalysisTestOK_ErrorAggregatorValidator",
		want: &ValidatorStruct{
			TypeName: "AnalysisTestOK_ErrorAggregatorValidator",
			ErrorHandler: &ErrorHandlerField{
				Name: "erragg", IsAggregator: true,
			},
			Fields: []*StructField{{
				Name: "F", Key: "F",
				Tag:  tagutil.Tag{"is": []string{"required"}},
				Type: Type{Kind: TypeKindString}, IsExported: true,
				RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}}},
			}},
		},
	}, {
		name: "AnalysisTestOK_ContextValidator",
		want: &ValidatorStruct{
			TypeName: "AnalysisTestOK_ContextValidator",
			ContextOption: &ContextOptionField{
				Name: "context",
			},
			Fields: []*StructField{{
				Name: "F", Key: "F",
				Tag:  tagutil.Tag{"is": []string{"required"}},
				Type: Type{Kind: TypeKindString}, IsExported: true,
				RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}}},
			}},
		},
	}, {
		name: "AnalysisTestOK_Context2Validator",
		want: &ValidatorStruct{
			TypeName: "AnalysisTestOK_Context2Validator",
			ContextOption: &ContextOptionField{
				Name: "Context",
			},
			Fields: []*StructField{{
				Name: "F", Key: "F",
				Tag:  tagutil.Tag{"is": []string{"required"}},
				Type: Type{Kind: TypeKindString}, IsExported: true,
				RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}}},
			}},
		},
	}, {
		name:     "AnalysisTestOK_Validator",
		printerr: true,
		want: &ValidatorStruct{
			TypeName: "AnalysisTestOK_Validator",
			ContextOption: &ContextOptionField{
				Name: "Context",
			},
			BeforeValidate: &MethodInfo{Name: "beforevalidate"},
			AfterValidate:  &MethodInfo{Name: "AfterValidate"},
			Fields: []*StructField{{
				Name:    "UserInput",
				Tag:     tagutil.Tag{"isvalid": []string{"omitkey"}},
				RuleTag: &RuleTag{},
				Type: Type{
					Kind: TypeKindPtr,
					Elem: &Type{
						Name:       "UserInput",
						Kind:       TypeKindStruct,
						PkgPath:    "github.com/frk/isvalid/internal/testdata",
						PkgName:    "testdata",
						PkgLocal:   "testdata",
						IsImported: true,
						IsExported: true,
						Fields: []*StructField{{
							Name: "CountryCode", Key: "CountryCode",
							Type: Type{Kind: TypeKindString}, IsExported: true,
							RuleTag: &RuleTag{},
						}, {
							Name: "SomeVersion", Key: "SomeVersion",
							Type: Type{Kind: TypeKindInt}, IsExported: true,
							RuleTag: &RuleTag{},
						}, {
							Name: "SomeValue", Key: "SomeValue",
							Type: Type{Kind: TypeKindString}, IsExported: true,
							RuleTag: &RuleTag{},
						}, {
							Name: "F1", Key: "F1",
							Tag:  tagutil.Tag{"is": []string{"required"}},
							Type: Type{Kind: TypeKindString}, IsExported: true,
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}}},
						}, {
							Name: "F2", Key: "F2", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"required:@create"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "required", Context: "create"}}},
							// NOTE the #key is dropped for now ...
							// }, {
							// 	Name: "F3", Key: "F3", IsExported: true,
							// 	Tag:     tagutil.Tag{"is": []string{"required:#key"}},
							// 	Type:    Type{Kind: TypeKindString},
							// 	RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}, {Name: "#key"}}},
							// }, {
							// 	Name: "F4", Key: "F4", IsExported: true,
							// 	Tag:     tagutil.Tag{"is": []string{"required:@create:#key"}},
							// 	Type:    Type{Kind: TypeKindString},
							// 	RuleTag: &RuleTag{Rules: []*Rule{{Name: "required", Context: "create"}, {Name: "#key"}}},
						}, {
							Name: "F5", Key: "F5", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"email"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "email"}}},
						}, {
							Name: "F6", Key: "F6", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"url"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "url"}}},
						}, {
							Name: "F7", Key: "F7", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"uri"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "uri"}}},
						}, {
							Name: "F8", Key: "F8", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"pan"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "pan"}}},
						}, {
							Name: "F9", Key: "F9", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"cvv"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "cvv"}}},
						}, {
							Name: "F10", Key: "F10", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"ssn"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ssn"}}},
						}, {
							Name: "F11", Key: "F11", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"ein"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ein"}}},
						}, {
							Name: "F12", Key: "F12", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"numeric"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "numeric"}}},
						}, {
							Name: "F13", Key: "F13", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"hex"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "hex"}}},
						}, {
							Name: "F14", Key: "F14", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"hexcolor"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "hexcolor"}}},
						}, {
							Name: "F15", Key: "F15", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"alphanum"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "alphanum"}}},
						}, {
							Name: "F16", Key: "F16", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"cidr"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "cidr"}}},
						}, {
							Name: "F17", Key: "F17", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"phone"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "phone"}}},
						}, {
							Name: "F18", Key: "F18", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"phone:us:ca"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "phone", Args: []*RuleArg{
								{Value: "us", Type: ArgTypeString},
								{Value: "ca", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F19", Key: "F19", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"phone:&CountryCode"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "phone", Args: []*RuleArg{
								{Value: "CountryCode", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F20", Key: "F20", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"zip"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "zip"}}},
						}, {
							Name: "F21", Key: "F21", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"zip:deu:fin"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "zip", Args: []*RuleArg{
								{Value: "deu", Type: ArgTypeString},
								{Value: "fin", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F22", Key: "F22", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"zip:&CountryCode"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "zip", Args: []*RuleArg{
								{Value: "CountryCode", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F23", Key: "F23", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"uuid"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "uuid"}}},
						}, {
							Name: "F24", Key: "F24", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"uuid:3"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "uuid", Args: []*RuleArg{
								{Value: "3", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F25", Key: "F25", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"uuid:v4"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "uuid", Args: []*RuleArg{
								{Value: "4", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F26", Key: "F26", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"uuid:&SomeVersion"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "uuid", Args: []*RuleArg{
								{Value: "SomeVersion", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F27", Key: "F27", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"ip"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ip"}}},
						}, {
							Name: "F28", Key: "F28", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"ip:4"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ip", Args: []*RuleArg{
								{Value: "4", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F29", Key: "F29", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"ip:v6"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ip", Args: []*RuleArg{
								{Value: "6", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F30", Key: "F30", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"ip:&SomeVersion"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ip", Args: []*RuleArg{
								{Value: "SomeVersion", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F31", Key: "F31", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{"mac"}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "mac"}}},
						}, {
							Name: "F32", Key: "F32", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"mac:6"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "mac", Args: []*RuleArg{
								{Value: "6", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F33", Key: "F33", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"mac:v8"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "mac", Args: []*RuleArg{
								{Value: "8", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F34", Key: "F34", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"mac:&SomeVersion"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "mac", Args: []*RuleArg{
								{Value: "SomeVersion", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F35", Key: "F35", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"iso:1234"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "iso", Args: []*RuleArg{
								{Value: "1234", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F36", Key: "F36", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{"rfc:1234"}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "rfc", Args: []*RuleArg{
								{Value: "1234", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F37", Key: "F37", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`re:"^[a-z]+\[[0-9]+\]$"`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "re", Args: []*RuleArg{
								{Value: `^[a-z]+\[[0-9]+\]$`, Type: ArgTypeString},
							}}}},
						}, {
							Name: "F38", Key: "F38", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`re:"\w+"`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "re", Args: []*RuleArg{
								{Value: `\w+`, Type: ArgTypeString},
							}}}},
						}, {
							Name: "F39", Key: "F39", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`contains:foo bar`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "contains", Args: []*RuleArg{
								{Value: "foo bar", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F40", Key: "F40", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`contains:&SomeValue`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "contains", Args: []*RuleArg{
								{Value: "SomeValue", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F41", Key: "F41", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`prefix:foo bar`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "prefix", Args: []*RuleArg{
								{Value: "foo bar", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F42", Key: "F42", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`prefix:&SomeValue`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "prefix", Args: []*RuleArg{
								{Value: "SomeValue", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F43", Key: "F43", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`suffix:foo bar`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "suffix", Args: []*RuleArg{
								{Value: "foo bar", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F44", Key: "F44", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`suffix:&SomeValue`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "suffix", Args: []*RuleArg{
								{Value: "SomeValue", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F45", Key: "F45", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`eq:foo bar`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "eq", Args: []*RuleArg{
								{Value: "foo bar", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F46", Key: "F46", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`eq:-123`}},
							Type: Type{Kind: TypeKindInt},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "eq", Args: []*RuleArg{
								{Value: "-123", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F47", Key: "F47", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`eq:123.987`}},
							Type: Type{Kind: TypeKindFloat64},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "eq", Args: []*RuleArg{
								{Value: "123.987", Type: ArgTypeFloat},
							}}}},
						}, {
							Name: "F48", Key: "F48", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`eq:&SomeValue`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "eq", Args: []*RuleArg{
								{Value: "SomeValue", Type: ArgTypeField},
							}}}},
						}, {
							Name: "F49", Key: "F49", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`ne:foo bar`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ne", Args: []*RuleArg{
								{Value: "foo bar", Type: ArgTypeString},
							}}}},
						}, {
							Name: "F50", Key: "F50", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`ne:-123`}},
							Type: Type{Kind: TypeKindInt},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ne", Args: []*RuleArg{
								{Value: "-123", Type: ArgTypeInt},
							}}}},
						}, {
							Name: "F51", Key: "F51", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`ne:123.987`}},
							Type: Type{Kind: TypeKindFloat64},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ne", Args: []*RuleArg{
								{Value: "123.987", Type: ArgTypeFloat},
							}}}},
						}, {
							Name: "F52", Key: "F52", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`ne:&SomeValue`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "ne", Args: []*RuleArg{
								{Value: "SomeValue", Type: ArgTypeField}}}}},
						}, {
							Name: "F53", Key: "F53", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`gt:24`, `lt:128`}},
							Type: Type{Kind: TypeKindUint8},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "gt", Args: []*RuleArg{
									{Value: "24", Type: ArgTypeInt}}},
								{Name: "lt", Args: []*RuleArg{
									{Value: "128", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F54", Key: "F54", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`gt:-128`, `lt:-24`}},
							Type: Type{Kind: TypeKindInt16},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "gt", Args: []*RuleArg{
									{Value: "-128", Type: ArgTypeInt}}},
								{Name: "lt", Args: []*RuleArg{
									{Value: "-24", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F55", Key: "F55", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`gt:0.24`, `lt:1.28`}},
							Type: Type{Kind: TypeKindFloat32},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "gt", Args: []*RuleArg{
									{Value: "0.24", Type: ArgTypeFloat}}},
								{Name: "lt", Args: []*RuleArg{
									{Value: "1.28", Type: ArgTypeFloat}}},
							}},
						}, {
							Name: "F56", Key: "F56", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`gte:24`, `lte:128`}},
							Type: Type{Kind: TypeKindUint8},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "gte", Args: []*RuleArg{
									{Value: "24", Type: ArgTypeInt}}},
								{Name: "lte", Args: []*RuleArg{
									{Value: "128", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F57", Key: "F57", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`gte:-128`, `lte:-24`}},
							Type: Type{Kind: TypeKindInt16},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "gte", Args: []*RuleArg{
									{Value: "-128", Type: ArgTypeInt}}},
								{Name: "lte", Args: []*RuleArg{
									{Value: "-24", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F58", Key: "F58", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`gte:0.24`, `lte:1.28`}},
							Type: Type{Kind: TypeKindFloat32},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "gte", Args: []*RuleArg{
									{Value: "0.24", Type: ArgTypeFloat}}},
								{Name: "lte", Args: []*RuleArg{
									{Value: "1.28", Type: ArgTypeFloat}}},
							}},
						}, {
							Name: "F59", Key: "F59", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`min:24`, `max:128`}},
							Type: Type{Kind: TypeKindUint8},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "min", Args: []*RuleArg{
									{Value: "24", Type: ArgTypeInt}}},
								{Name: "max", Args: []*RuleArg{
									{Value: "128", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F60", Key: "F60", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`min:-128`, `max:-24`}},
							Type: Type{Kind: TypeKindInt16},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "min", Args: []*RuleArg{
									{Value: "-128", Type: ArgTypeInt}}},
								{Name: "max", Args: []*RuleArg{
									{Value: "-24", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F61", Key: "F61", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`min:0.24`, `max:1.28`}},
							Type: Type{Kind: TypeKindFloat32},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "min", Args: []*RuleArg{
									{Value: "0.24", Type: ArgTypeFloat}}},
								{Name: "max", Args: []*RuleArg{
									{Value: "1.28", Type: ArgTypeFloat}}},
							}},
						}, {
							Name: "F62", Key: "F62", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`rng:24:128`}},
							Type: Type{Kind: TypeKindUint8},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "rng", Args: []*RuleArg{
								{Value: "24", Type: ArgTypeInt},
								{Value: "128", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F63", Key: "F63", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`rng:-128:-24`}},
							Type: Type{Kind: TypeKindInt16},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "rng", Args: []*RuleArg{
								{Value: "-128", Type: ArgTypeInt},
								{Value: "-24", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F64", Key: "F64", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`rng:0.24:1.28`}},
							Type: Type{Kind: TypeKindFloat32},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "rng", Args: []*RuleArg{
								{Value: "0.24", Type: ArgTypeFloat},
								{Value: "1.28", Type: ArgTypeFloat}}},
							}},
						}, {
							Name: "F65", Key: "F65", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:28`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F66", Key: "F66", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:28`}},
							Type: Type{Kind: TypeKindSlice, Elem: &Type{Kind: TypeKindInt}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F67", Key: "F67", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:28`}},
							Type: Type{Kind: TypeKindMap, Key: &Type{Kind: TypeKindString}, Elem: &Type{Kind: TypeKindInt}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F68", Key: "F68", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:4:28`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "4", Type: ArgTypeInt},
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F69", Key: "F69", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:4:28`}},
							Type: Type{Kind: TypeKindSlice, Elem: &Type{Kind: TypeKindInt}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "4", Type: ArgTypeInt},
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F70", Key: "F70", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:4:28`}},
							Type: Type{Kind: TypeKindMap, Key: &Type{Kind: TypeKindString}, Elem: &Type{Kind: TypeKindInt}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "4", Type: ArgTypeInt},
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F71", Key: "F71", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len::28`}},
							Type: Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "", Type: ArgTypeUnknown},
								{Value: "28", Type: ArgTypeInt}}},
							}},
						}, {
							Name: "F72", Key: "F72", IsExported: true,
							Tag:  tagutil.Tag{"is": []string{`len:4:`}},
							Type: Type{Kind: TypeKindSlice, Elem: &Type{Kind: TypeKindInt}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
								{Value: "4", Type: ArgTypeInt},
								{Value: "", Type: ArgTypeUnknown}}},
							}},
						}, {
							Name: "G1", Key: "G1", IsExported: true,
							Type: Type{Kind: TypeKindStruct,
								Fields: []*StructField{{
									Name: "F1", Key: "G1.F1", IsExported: true,
									Tag:     tagutil.Tag{"is": []string{`required`}},
									Type:    Type{Kind: TypeKindString},
									RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}}},
								}},
							},
							RuleTag: &RuleTag{},
						}, {
							Name: "F73", Key: "F73", IsExported: true,
							Tag:     tagutil.Tag{"is": []string{`utf8`}},
							Type:    Type{Kind: TypeKindString},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "utf8"}}},
						}, {
							Name: "F74", Key: "F74", IsExported: true,
							Type: Type{
								Kind:       TypeKindStruct,
								Name:       "Time",
								PkgPath:    "time",
								PkgName:    "time",
								PkgLocal:   "time",
								IsImported: true,
								IsExported: true,
							},
							Tag: tagutil.Tag{"is": []string{`timecheck`, `ifacecheck`}},
							RuleTag: &RuleTag{Rules: []*Rule{
								{Name: "timecheck"},
								{Name: "ifacecheck"},
							}},
						}, {
							Name: "F75", Key: "F75", IsExported: true,
							Type: Type{
								Kind:       TypeKindString,
								Name:       "MyString",
								PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
								PkgName:    "mypkg",
								PkgLocal:   "mypkg",
								IsImported: true,
								IsExported: true,
								CanIsValid: true,
							},
							Tag:     tagutil.Tag{"is": []string{`required`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}, {Name: "isvalid"}}},
						}, {
							Name: "F76", Key: "F76", IsExported: true,
							Type: Type{
								Kind:       TypeKindInt,
								Name:       "MyInt",
								PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
								PkgName:    "mypkg",
								PkgLocal:   "mypkg",
								IsImported: true,
								IsExported: true,
								CanIsValid: true,
							},
							Tag:     tagutil.Tag{"is": []string{`required`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "required"}, {Name: "isvalid"}}},
						}, {
							Name: "F77", Key: "F77", IsExported: true,
							Type: Type{
								Kind: TypeKindPtr,
								Elem: &Type{
									Kind:       TypeKindString,
									Name:       "MyString",
									PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
									PkgName:    "mypkg",
									PkgLocal:   "mypkg",
									IsImported: true,
									IsExported: true,
									CanIsValid: true,
								},
							},
							Tag:     tagutil.Tag{"is": []string{`-isvalid`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "-isvalid"}}},
						}, {
							Name: "F78", Key: "F78", IsExported: true,
							Type: Type{
								Kind: TypeKindPtr,
								Elem: &Type{
									Kind: TypeKindPtr,
									Elem: &Type{
										Kind:       TypeKindInt,
										Name:       "MyInt",
										PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
										PkgName:    "mypkg",
										PkgLocal:   "mypkg",
										IsImported: true,
										IsExported: true,
										CanIsValid: true,
									},
								},
							},
							Tag:     tagutil.Tag{"is": []string{`isvalid:@create`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "isvalid", Context: "create"}}},
						}, {
							Name: "F79", Key: "F79", IsExported: true,
							Type: Type{
								Kind: TypeKindPtr,
								Elem: &Type{
									Kind:       TypeKindInterface,
									CanIsValid: true,
								},
							},
							Tag:     nil,
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "isvalid"}}},
						}, {
							Name: "F80", Key: "F80", IsExported: true,
							Type: Type{
								Kind:       TypeKindString,
								Name:       "someKind",
								PkgPath:    "github.com/frk/isvalid/internal/testdata",
								PkgName:    "testdata",
								PkgLocal:   "testdata",
								IsImported: true,
							},
							Tag:     tagutil.Tag{"is": []string{`enum`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "enum"}}},
						}, {
							Name: "F81", Key: "F81", IsExported: true,
							Type: Type{
								Kind:       TypeKindUint,
								Name:       "MyKind",
								PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
								PkgName:    "mypkg",
								PkgLocal:   "mypkg",
								IsImported: true,
								IsExported: true,
							},
							Tag:     tagutil.Tag{"is": []string{`enum`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "enum"}}},
						}, {
							Name: "F82", Key: "F82", IsExported: true,
							Type: Type{
								Kind: TypeKindPtr,
								Elem: &Type{
									Kind: TypeKindPtr,
									Elem: &Type{
										Kind:       TypeKindString,
										Name:       "someKind",
										PkgPath:    "github.com/frk/isvalid/internal/testdata",
										PkgName:    "testdata",
										PkgLocal:   "testdata",
										IsImported: true,
									},
								},
							},
							Tag:     tagutil.Tag{"is": []string{`enum`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "enum"}}},
						}, {
							Name: "F83", Key: "F83", IsExported: true,
							Type: Type{
								Kind: TypeKindPtr,
								Elem: &Type{
									Kind:       TypeKindUint,
									Name:       "MyKind",
									PkgPath:    "github.com/frk/isvalid/internal/testdata/mypkg",
									PkgName:    "mypkg",
									PkgLocal:   "mypkg",
									IsImported: true,
									IsExported: true,
								},
							},
							Tag:     tagutil.Tag{"is": []string{`enum:@create`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "enum", Context: "create"}}},
						}, {
							Name: "F84", Key: "F84", IsExported: true,
							Type: Type{
								Kind: TypeKindSlice,
								Elem: &Type{Kind: TypeKindString},
							},
							Tag:     tagutil.Tag{"is": []string{`[]email`}},
							RuleTag: &RuleTag{Elem: &RuleTag{Rules: []*Rule{{Name: "email"}}}},
						}, {
							Name: "F85", Key: "F85", IsExported: true,
							Type: Type{
								Kind: TypeKindMap,
								Key:  &Type{Kind: TypeKindString},
								Elem: &Type{Kind: TypeKindString},
							},
							Tag:     tagutil.Tag{"is": []string{`[email]`}},
							RuleTag: &RuleTag{Key: &RuleTag{Rules: []*Rule{{Name: "email"}}}},
						}, {
							Name: "F86", Key: "F86", IsExported: true,
							Type: Type{
								Kind: TypeKindMap,
								Key:  &Type{Kind: TypeKindString},
								Elem: &Type{Kind: TypeKindString},
							},
							Tag: tagutil.Tag{"is": []string{`[phone:us:ca]zip:ca:us`}},
							RuleTag: &RuleTag{
								Key: &RuleTag{Rules: []*Rule{
									{Name: "phone", Args: []*RuleArg{
										{Value: "us", Type: ArgTypeString},
										{Value: "ca", Type: ArgTypeString},
									}},
								}},
								Elem: &RuleTag{Rules: []*Rule{
									{Name: "zip", Args: []*RuleArg{
										{Value: "ca", Type: ArgTypeString},
										{Value: "us", Type: ArgTypeString},
									}},
								}},
							},
						}, {
							Name: "F87", Key: "F87", IsExported: true,
							Type: Type{
								Kind: TypeKindMap,
								Key:  &Type{Kind: TypeKindString},
								Elem: &Type{Kind: TypeKindPtr, Elem: &Type{
									Kind: TypeKindStruct,
									Fields: []*StructField{{
										Name: "F1", Key: "F87.F1", IsExported: true,
										Type: Type{Kind: TypeKindString},
										Tag:  tagutil.Tag{"is": []string{`len:2:32`}},
										RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
											{Value: "2", Type: ArgTypeInt},
											{Value: "32", Type: ArgTypeInt},
										}}}},
									}, {
										Name: "F2", Key: "F87.F2", IsExported: true,
										Type: Type{Kind: TypeKindString},
										Tag:  tagutil.Tag{"is": []string{`len:2:32`}},
										RuleTag: &RuleTag{Rules: []*Rule{{Name: "len", Args: []*RuleArg{
											{Value: "2", Type: ArgTypeInt},
											{Value: "32", Type: ArgTypeInt},
										}}}},
									}, {
										Name: "F3", Key: "F87.F3", IsExported: true,
										Type:    Type{Kind: TypeKindString},
										Tag:     tagutil.Tag{"is": []string{`phone`}},
										RuleTag: &RuleTag{Rules: []*Rule{{Name: "phone"}}},
									}},
								}},
							},
							Tag:     tagutil.Tag{"is": []string{`[email]`}},
							RuleTag: &RuleTag{Key: &RuleTag{Rules: []*Rule{{Name: "email"}}}},
						}, {
							Name: "F88", Key: "F88", IsExported: true,
							Type: Type{
								Kind: TypeKindSlice,
								Elem: &Type{Kind: TypeKindString},
							},
							Tag:     tagutil.Tag{"is": []string{`notnil`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "notnil"}}},
						}, {
							Name: "F89", Key: "F89", IsExported: true,
							Type: Type{
								Kind: TypeKindMap,
								Key:  &Type{Kind: TypeKindString},
								Elem: &Type{Kind: TypeKindString},
							},
							Tag:     tagutil.Tag{"is": []string{`notnil`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "notnil"}}},
						}, {
							Name: "F90", Key: "F90", IsExported: true,
							Type: Type{
								Kind:             TypeKindInterface,
								IsEmptyInterface: true,
							},
							Tag:     tagutil.Tag{"is": []string{`notnil`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "notnil"}}},
						}, {
							Name: "F91", Key: "F91", IsExported: true,
							Type: Type{
								Kind: TypeKindPtr,
								Elem: &Type{Kind: TypeKindString},
							},
							Tag:     tagutil.Tag{"is": []string{`notnil`}},
							RuleTag: &RuleTag{Rules: []*Rule{{Name: "notnil"}}},
						}, {
							Name: "F92", Key: "F92", IsExported: true,
							Type: Type{
								Kind: TypeKindSlice,
								Elem: &Type{
									Kind: TypeKindMap,
									Key: &Type{
										Kind: TypeKindPtr,
										Elem: &Type{
											Kind: TypeKindMap,
											Key: &Type{
												Kind: TypeKindString,
											},
											Elem: &Type{
												Kind: TypeKindString,
											},
										},
									},
									Elem: &Type{
										Kind: TypeKindSlice,
										Elem: &Type{
											Kind: TypeKindInt,
										},
									},
								},
							},
							Tag: tagutil.Tag{"is": []string{
								`[][[email]phone:us:ca]len::10`,
								`[]rng:-54:256`,
							}},
							RuleTag: &RuleTag{
								Elem: &RuleTag{
									Key: &RuleTag{
										Key: &RuleTag{Rules: []*Rule{{Name: "email"}}},
										Elem: &RuleTag{Rules: []*Rule{
											{Name: "phone", Args: []*RuleArg{
												{Value: "us", Type: ArgTypeString},
												{Value: "ca", Type: ArgTypeString},
											}},
										}},
									},
									Elem: &RuleTag{
										Rules: []*Rule{
											{Name: "len", Args: []*RuleArg{
												{Value: "", Type: ArgTypeUnknown},
												{Value: "10", Type: ArgTypeInt},
											}},
										},
										Elem: &RuleTag{Rules: []*Rule{
											{Name: "rng", Args: []*RuleArg{
												{Value: "-54", Type: ArgTypeInt},
												{Value: "256", Type: ArgTypeInt},
											}},
										}},
									},
								},
							},
						}},
					},
				},
				IsExported: true,
			}},
		},
	}}

	compare := compare.Config{ObserveFieldTag: "cmp"}

	anConf := Config{FieldKeyJoin: true, FieldKeySeparator: "."}
	anConf.ruleSpecMap = map[string]RuleSpec{
		// legit
		"utf8": RuleFunc{
			FuncName: "ValidString",
			PkgPath:  "unicode/utf8",
			ArgTypes: []Type{{Kind: TypeKindString}},
			iscustom: true,
		},

		// for testing success
		"timecheck": RuleFunc{
			FuncName: "TimeCheck", PkgPath: "path/to/rule",
			ArgTypes: []Type{{Kind: TypeKindStruct, Name: "Time", PkgPath: "time", PkgName: "time"}},
			iscustom: true,
		},
		"ifacecheck": RuleFunc{
			FuncName: "IfaceCheck", PkgPath: "path/to/rule",
			ArgTypes: []Type{{Kind: TypeKindInterface, IsEmptyInterface: true}},
			iscustom: true,
		},

		// for testing errors
		"rulefunc1": RuleFunc{
			FuncName: "RuleFunc1", PkgPath: "path/to/rule",
			ArgTypes: []Type{{Kind: TypeKindString}, {Kind: TypeKindInt}},
			iscustom: true,
		},
		"rulefunc2": RuleFunc{
			FuncName: "RuleFunc2", PkgPath: "path/to/rule",
			ArgTypes: []Type{{Kind: TypeKindString}, {Kind: TypeKindInt},
				{Kind: TypeKindSlice, Elem: &Type{Kind: TypeKindBool}}},
			IsVariadic: true, iscustom: true,
		},
	}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			match := getMatch(tt.name, t)
			got, err := anConf.Analyze(testast, match, &Info{})
			if e := compare.Compare(err, tt.err); e != nil {
				t.Errorf("Error: %v", e)
			}
			if e := compare.Compare(got, tt.want); e != nil {
				t.Error(e)
			}

			if tt.printerr && err != nil {
				fmt.Println(err)
			}
		})
	}
}

func TestContainsRules(t *testing.T) {
	tests := []struct {
		name string
	}{
		{name: "ContainsRulesTest1Validator"},
		{name: "ContainsRulesTest2Validator"},
		{name: "ContainsRulesTest3Validator"},
		{name: "ContainsRulesTest4Validator"},
		{name: "ContainsRulesTest5Validator"},
	}

	anConf := Config{FieldKeyJoin: true, FieldKeySeparator: "."}

	for _, tt := range tests {
		t.Run(tt.name, func(t *testing.T) {
			match := getMatch(tt.name, t)
			vs, err := anConf.Analyze(testast, match, &Info{})
			if err != nil {
				t.Errorf("Error: %v", err)
			} else if len(vs.Fields) != 2 {
				t.Errorf("Bad number of fields: want=2 got=%d", len(vs.Fields))
			} else {
				for _, f := range vs.Fields {
					if f.Name == "yes" && !f.ContainsRules() {
						t.Errorf("%q does not contain rules.", f.Name)
					}
					if f.Name == "no" && f.ContainsRules() {
						t.Errorf("%q does contain rules.", f.Name)
					}
				}
			}
		})
	}
}

func getMatch(name string, t *testing.T) *search.Match {
	for _, file := range testpkg.Files {
		for _, match := range file.Matches {
			if match.Named.Obj().Name() == name {
				return match
			}
		}
	}

	t.Fatal(name, " not found")
	return nil
}
